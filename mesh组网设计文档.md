# MESH组网设计文档
## 设计思路
- 主路由器和节点采用socket通信，主路由作为服务器，创建一个虚拟的vap4，固定ssid和密码。同时隐藏ssid。通信成功以后切换到AP+MESH模式
- 节点的2.4g工作在客户端模式，去连接服务器的vap4，连接成功以后会分配ip，通信成功以后切换到MESH模式
## 主路由
- 主路由器的默认模式：2.4G和5G出厂都是AP+MESH模式
- 当按下组网按键后，主路由会将2.4G的模式切换成AP模式(因为目前的sdk在AP+MESH的模式下，不能打开VAP)
- 主路由会等待节点连接(默认30秒)，节点连接成功以后，会将主路由的mesh的相关信息发送到节点，节点收到以后会发送ack。主路由收到ack之后，会切换到AP+MESH模式

## 节点
- 节点出厂5G为AP+MESH模式，2.4G为客户端模式
- 当按下组网按键以后，节点会将默认的ssid和密码填充到相关的flash变量，然后重启2.4g的无线
- 因为2.4g是客户端模式，所以节点会去连接拥有相同密码的主路由器，然后会从主路由器拿到ip地址
- 拿到ip地址后，节点会从主路由器拿到主路由器mesh相关的信息，然后回复ack个服务器
- 填充相关的mesh，将2.4g配置为AP+MESH的模式。